二维xy平面

依据夏令营比赛规则中的内容，我要实现兑矿区的代码。
1.用拨杆四个挡位分别代表四个兑换等级，代码中已给出
2.M2006电机转一圈对应丝杆直线移动2mm，编码器分辨率8191
3.XY二维平面，X、Y轴丝杆移动分别由一个M2006电机控制。xy范围已给出，初始坐标(0, 250)
4.在三秒内完成兑矿槽的移动
5.以x轴电机为例，获取电机编码器值的接口为XYcontrol->x_motor.encoder(), 也可以
  获取角度XYcontrol->x_motor.pos_degree()和弧度XYcontrol->x_motor.pos_rad(), 获取电机转速的接口为XYcontrol->y_motor.rpm()
6.两个M2006电机都是速度单环，motor_speed为目标值，反馈值为XYcontrol->y_motor.rpm()。
  给电机设置电流的接口为XYcontrol->x_motor.SetCurrent(), 发送电机控制指令的接口为M2006::SendCommand();

要点：
1.启动时并不知道兑矿槽的位置，需要知道兑矿槽的坐标，然后才能开始移动。
思路：启动时兑矿槽在中间(可以用遥控器控制到中间)，坐标（0， 250），电机一圈2mm, 分为正反转(正转为1，反转为-1)，正转从0到8191，会有8191—->0的过程, 反转从8191到0，会有0—->8191的过程。
    可以设置一个计数变量cnt，过零时正转加2，反转减2，代表xy轴电机的位置变化量。给xy轴电机各自设置一个计数变量，x_cnt限制范围(-380, 380), y_cnt限制范围(-130, 130)。
    达到边界时设置为power_off，停止电机运动。
tips:xy轴电机都是正装，顺时针为正。

2.兑矿等级的选择
思路：用level变量1~4来表示兑矿等级。依据level变量的值(注意随机数的使用)对新的计数变量cnt_new赋值(保证其为偶数，若非+1)，
    若cnt_new>cnt，则正转(cnt_new-cnt)/2，若cnt_new<cnt，则反转(cnt-cnt_new)/2，若cnt_new=cnt，则不动。差值变量为cnt_error=fbs(cnt_new-cnt)，注意方向没有指定。

3.电机控制
思路：xy轴电机都采用单速度环控制，其PID参数x_pid_speed(12, 0, 0, 30000, 0)和输出值
    更新形式XYcontrol->x_pid_speed.Update(motor_speed, XYcontrol->x_motor.rpm())以及设置电流XYcontrol->x_motor.SetCurrent(XYcontrol->x_pid_speed.value())是固定的，能改的只是PID参数。扭矩大小取决于电机转速，电流大小取决于电机转速和电机转矩。
    如果速度太慢可以适当增加motor_speed，如果速度太快可以适当减小motor_speed。主要是根据计数变量对电机进行控制，对其转圈圈数进行记录。
    依据差值变量cnt_error对电机进行控制，电机正转使得cnt==cnt_new，电机反转使得cnt==cnt_new，电机不动（强制设为0，即不动，当然，要依据兑矿等级）。

4.匀速运动
思路：利用电机rpm, 需要0.2m/s, 即12000mm/min，而1rpm=2mm/min, 所以rpm=12000/0.2=6000rpm。即需要将motor_speed设置为6000。需要往复运动，所以需要在计数变量到达边界时将motor_speed取反。

(先忽略这个，先实现基本的移动功能)5.计时并计算胜利点：
需求：兑矿槽经过三秒移动到指定位置后绿灯亮起表示允许兑矿，开始计时，微动开关触发一秒后结束计时并计算胜利点。
思路：新建一个线程，专门用于这个需求

目前：
1.x轴最高移速1.8cm/s，y轴最高移速为7.4cm/s。->换丝杆(润滑油)，减速箱最大输出转速9.26r/s，导程n mm, 则丝杆最大移速为9.26n mm/s -> x轴导程换成14mm
2.看一下匀速状态下x轴和y轴的偏移，手动加offset(双精度)看一下误差(解决)
3.状态机切换的问题(解决)
4.当选手兑矿完成触发微动开关绿灯熄灭时，只有在选手再次选择兑矿等级(包括切回原来的等级)，才开始计时亮起green_light, 而不是时刻计时。


问题：
1.没有超时的时候绿灯始终可以切换状态，应该触发一次开关后就不能再触发->加一个兑矿成功标志位(解决)
2.切换等级时一直在计时而不是重新计时？(卡在moving状态里面没出来，挡位切换没用) -> 尝试合并状态机(解决)
3.亮起之后切回复位档还亮着？(没触发微动开关，回不去idle状态，挡位切换没用) -> 保留？(讨论一下)
4.OLED实测VCC为3.3V供电(5V供电也能显示，但是数据手册里建议3.3V)，用GPIO_Output逻辑电平3.3V供电OLED无法显示-> 可能是IO口输出电流不够
5.继电器LED(解决)

问题：
1.IIC通信异常，导致CAN异常？(主要矛盾)->yes！
2.运动逻辑和计时逻辑耦合-> 问题不大
3.兑矿成功后再次切回原来的挡位并保持？-> 解决(给的检查时间太少了，时间一到就会暂停)
4.y轴偏差太大(差不多能用)

需求：
1.可以随时切换状态并重新计时(把状态机移到switch外面)
2.兑矿完成兑矿槽停止(exchange_success标志位和reset_flag标志位)

问题：
1.兑矿等级三、四复位时误差大？(无规律)
2.兑矿成功后无法切回复位档？（解决）
3.亮灯后挡位切换异常 -> 需要切回复位档才能再次切换兑矿等级

需求2.0:
1.单次兑矿时间显示(OK)
2.第二行手动兑矿胜利点，第三行自动兑矿胜利点